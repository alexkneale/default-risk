import"./style-zjcxYXbO.js";import{C as x,B,L as E,P as F,a as O,b as S,c as w,d as P,p as L,e as N,f as T,g as U,A,h as $}from"./papaparse.min-4EPW4OwA.js";x.register(B,E,F,O,S,w,P,L,N,T,U,A);const C={id:"yourScoreLabelPlugin",afterDatasetsDraw(n){const{ctx:o,scales:{x:e,y:g}}=n,s=n.config.data.datasets[0].data.findIndex((D,u)=>n.config.data.datasets[0].backgroundColor[u]==="red");if(s===-1)return;const d=e.getPixelForTick(s),r=g.getPixelForValue(n.config.data.datasets[0].data[s]||0);o.save(),o.fillStyle="black",o.font="bold 12px sans-serif",o.textAlign="center",o.fillText("You",d,r-10),o.restore()}};x.register(C);const p=document.getElementById("mortgage-form");if(!p)throw new Error("No form");const k=(n,o,e,g,s,d)=>{fetch("/default-risk/data/freddiemac.csv").then(r=>r.text()).then(r=>{const u=$.parse(r,{header:!0,skipEmptyLines:!0}).data.map(t=>parseInt(t[n])).filter(t=>!isNaN(t)),i={};for(let t=g;t<=s;t+=e)i[`${t}-${t+e-1}`]=0;u.forEach(t=>{const a=Math.floor(t/e)*e,f=`${a}-${a+e-1}`;i[f]!==void 0&&i[f]++});const l=Object.keys(i),b=Object.values(i),_=b.reduce((t,a)=>t+=a),y=b.map(t=>t/_*100),m=l.findIndex(t=>{const[a,f]=t.split("-").map(Number);return o>=a&&o<=f}),h=l.map((t,a)=>a===m?"red":"rgba(54, 162, 235, 0.5)");new x(n+"Chart",{type:"bar",data:{labels:l,datasets:[{label:d+" Distribution",data:y,backgroundColor:h}]},options:{responsive:!0,plugins:{legend:{display:!0},tooltip:{mode:"index",intersect:!1}},scales:{y:{ticks:{callback:t=>`${t}`},beginAtZero:!0,title:{display:!0,text:"Percentage of Consumer Population"}},x:{title:{display:!0,text:d+" Ranges"}}}},plugins:[C]})})};window.addEventListener("DOMContentLoaded",()=>{const n=sessionStorage.getItem("userInputs");if(!n){console.error("No user input data found");return}const o=JSON.parse(n);Object.entries(o).forEach(([m,h])=>{const t=p.elements.namedItem(m);t&&(t.value=h)}),console.log(o);const e=parseInt(o["credit-score"]);k("fico",e,20,300,850,"Credit Score");const r=parseInt(o.debt)/parseInt(o.income)*100;k("dti",r,5,0,99,"Debt to Income Ratio");const l=parseFloat(o["new-mortgage-value"]);k("orig_upb",l,5e4,0,9e5,"Requested Mortgage Size"),new x("pieDefault",{type:"pie",data:{labels:["Defaulting","Not Defaulting"],datasets:[{label:"How common is defaulting?",data:[2.2,97.8],backgroundColor:["rgb(255, 99, 132)","rgb(54, 162, 235)"],hoverOffset:4}]}}),new x("pieAlgorithm",{type:"pie",data:{labels:["Defaulting, and correctly flagged by algorithm","Defaulting, and mistakenly not flagged by algorithm","Not defaulting, and mistakenly flagged by algorithm","Not defaulting, and correctly not flagged by algorithm"],datasets:[{label:"How common is defaulting?",data:[1.5,.7,25,53],backgroundColor:["rgb(255, 99, 132)","rgb(54, 162, 235)","rgb(255, 205, 86)","green"],hoverOffset:4}]}}),p.style.backgroundColor="#fbe4e4"});p.addEventListener("submit",n=>{n.preventDefault();const o=new FormData(p),e={};o.forEach((c,I)=>{e[I]=c.toString()});const g=parseInt(e.units),s=e.prop_type,d=e.metro,r=parseInt(e["people-responsible"]),D=parseFloat(e["credit-score"]),u=e["first-property"],i=e["property-purpose"],l=parseFloat(e.income),b=parseFloat(e.debt),_=l?b/l*100:0,y=parseFloat(e.prop_value),m=parseFloat(e["new-mortgage-value"]),h=y?m/y*100:0,t=parseFloat(e["int-rt"]),a=parseInt(e.length),f=parseInt(e.insurance),v={fico:D,flag_fthb:u,mi_pct:f,cnt_units:g,occpy_sts:i,cltv:h,dti:_,orig_upb:m,int_rt:t,prop_type:s,loan_purpose:e["mortgage-purpose"],orig_loan_term:a,cnt_borr:r,metro:d==="True"};fetch("https://default-risk.onrender.com/predict",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)}).then(c=>c.json()).then(c=>{console.log("Prediction:",c.default_prediction);const I=document.getElementById("form-message");c.default_prediction===1?(console.log("HERE"),p.style.backgroundColor="#fbe4e4",I.innerText="This mortgage request has been flagged as risky ⚠️"):(p.style.backgroundColor="#d1f5e0",I.innerText="This current mortgage request is approved ✅")}).catch(c=>{console.error("Error calling prediction API:",c)})});
