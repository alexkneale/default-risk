import"./style-AVmhBIh9.js";import{C as I,B,L as E,P as O,a as w,b as S,c as F,d as L,p as P,e as N,f as T,g as U,A,h as $}from"./papaparse.min-4EPW4OwA.js";I.register(B,E,O,w,S,F,L,P,N,T,U,A);const v={id:"yourScoreLabelPlugin",afterDatasetsDraw(n){const{ctx:o,data:t}=n,d=n.getDatasetMeta(0).data,i=t.datasets[0].data.findIndex((l,r)=>t.datasets[0].backgroundColor[r]==="red");if(i===-1||!d[i])return;const a=d[i],y=a.x,g=a.y;o.save(),o.fillStyle="black",o.font="bold 12px sans-serif",o.textAlign="center",o.fillText("You",y,g-10),o.restore()}};I.register(v);const p=document.getElementById("mortgage-form");if(!p)throw new Error("No form");const k=(n,o,t,f,d,i)=>{fetch("/default-risk/data/freddiemac.csv").then(a=>a.text()).then(a=>{const g=$.parse(a,{header:!0,skipEmptyLines:!0}).data.map(e=>parseInt(e[n])).filter(e=>!isNaN(e)),l={};for(let e=f;e<=d;e+=t)l[`${e}-${e+t-1}`]=0;g.forEach(e=>{const s=Math.floor(e/t)*t,m=`${s}-${s+t-1}`;l[m]!==void 0&&l[m]++});const r=Object.keys(l),h=Object.values(l),_=h.reduce((e,s)=>e+=s),D=h.map(e=>e/_*100),u=r.findIndex(e=>{const[s,m]=e.split("-").map(Number);return o>=s&&o<=m}),x=r.map((e,s)=>s===u?"red":"rgba(54, 162, 235, 0.5)");new I(n+"Chart",{type:"bar",data:{labels:r,datasets:[{label:i+" Distribution",data:D,backgroundColor:x}]},options:{responsive:!0,plugins:{legend:{display:!0},tooltip:{mode:"index",intersect:!1}},scales:{y:{ticks:{callback:e=>`${e}`},beginAtZero:!0,title:{display:!0,text:"Percentage of Consumer Population"}},x:{title:{display:!0,text:i+" Ranges"}}}},plugins:[v]})})};window.addEventListener("DOMContentLoaded",()=>{const n=sessionStorage.getItem("userInputs");if(!n){console.error("No user input data found");return}const o=JSON.parse(n);Object.entries(o).forEach(([u,x])=>{const e=p.elements.namedItem(u);e&&(e.value=x)}),console.log(o);const t=parseInt(o["credit-score"]);k("fico",t,20,300,850,"Credit Score");const a=parseInt(o.debt)/parseInt(o.income)*100;k("dti",a,5,0,99,"Debt to Income Ratio");const r=parseFloat(o["new-mortgage-value"]);k("orig_upb",r,5e4,0,9e5,"Requested Loan Size"),new I("pieDefault",{type:"pie",data:{labels:["Defaulting","Not Defaulting"],datasets:[{label:"How common is defaulting?",data:[2.2,97.8],backgroundColor:["rgb(255, 99, 132)","rgb(54, 162, 235)"],hoverOffset:4}]}}),new I("pieAlgorithm",{type:"pie",data:{labels:["Defaulting, and correctly flagged by algorithm","Defaulting, and mistakenly not flagged by algorithm","Not defaulting, and mistakenly flagged by algorithm","Not defaulting, and correctly not flagged by algorithm"],datasets:[{label:"How common is defaulting?",data:[1.5,.7,25,53],backgroundColor:["rgb(255, 99, 132)","rgb(54, 162, 235)","rgb(255, 205, 86)","green"],hoverOffset:4}]}}),p.style.backgroundColor="#d1f5e0"});p.addEventListener("submit",n=>{n.preventDefault();const o=new FormData(p),t={};o.forEach((c,b)=>{t[b]=c.toString()});const f=parseInt(t.units),d=t.prop_type,i=t.metro,a=parseInt(t["people-responsible"]),y=parseFloat(t["credit-score"]),g=t["first-property"],l=t["property-purpose"],r=parseFloat(t.income),h=parseFloat(t.debt),_=r?h/r*100:0,D=parseFloat(t.prop_value),u=parseFloat(t["new-mortgage-value"]),x=D?u/D*100:0,e=parseFloat(t["int-rt"]),s=parseInt(t.length),m=parseInt(t.insurance),C={fico:y,flag_fthb:g,mi_pct:m,cnt_units:f,occpy_sts:l,cltv:x,dti:_,orig_upb:u,int_rt:e,prop_type:d,loan_purpose:t["mortgage-purpose"],orig_loan_term:s,cnt_borr:a,metro:i==="True"};fetch("https://default-risk.onrender.com/predict",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(C)}).then(c=>c.json()).then(c=>{console.log("Prediction:",c.default_prediction);const b=document.getElementById("form-message");c.default_prediction===1?(console.log("HERE"),p.style.backgroundColor="#fbe4e4",b.innerText="This mortgage request has been flagged as risky ⚠️",b?.scrollIntoView({behavior:"smooth",block:"start"})):(p.style.backgroundColor="#d1f5e0",b.innerText="This current mortgage request is approved ✅",b?.scrollIntoView({behavior:"smooth",block:"start"}))}).catch(c=>{console.error("Error calling prediction API:",c)})});
